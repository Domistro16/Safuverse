specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # ── AgentRegistrarController ─────────────────────────────────────
  - kind: ethereum
    name: AgentRegistrarController
    network: base
    source:
      address: "0xB5f3F983368e993b5f42D1dd659e4dC36fa5C494"
      abi: AgentRegistrarController
      startBlock: 25000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - DomainOwner
        - Domain
        - Transaction
        - PointsEvent
      abis:
        - name: AgentRegistrarController
          file: ./abis/AgentRegistrarController.json
      eventHandlers:
        - event: NameRegistered(string,indexed bytes32,indexed address,uint256,uint256)
          handler: handleAgentNameRegistered
        - event: BatchRegistered(uint256,indexed address,uint256)
          handler: handleBatchRegistered
        - event: AgentWalletDeployed(indexed address,indexed address,string)
          handler: handleAgentWalletDeployed
        - event: PointsAwarded(indexed address,string,uint256,uint256,uint256)
          handler: handlePointsAwarded
        - event: CommitmentMade(indexed bytes32,indexed address)
          handler: handleCommitmentMade
      file: ./src/mapping.ts

  # ── ETHRegistrarController ───────────────────────────────────────
  - kind: ethereum
    name: ETHRegistrarController
    network: base
    source:
      address: "0x7DeCA111771082771E527Ae9A38f593a684e31FB"
      abi: ETHRegistrarController
      startBlock: 25000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - DomainOwner
        - Domain
        - Transaction
      abis:
        - name: ETHRegistrarController
          file: ./abis/ETHRegistrarController.json
      eventHandlers:
        - event: NameRegistered(string,indexed bytes32,indexed address,uint256,uint256,uint256)
          handler: handleETHNameRegistered
        - event: NameRenewed(string,indexed bytes32,uint256,uint256)
          handler: handleNameRenewed
      file: ./src/mapping.ts

  # ── BaseRegistrar (ERC721) ──────────────────────────────────────
  - kind: ethereum
    name: BaseRegistrar
    network: base
    source:
      address: "0xCAfd2aCA95B79Ce2De0047F2309FCaB33Da75E9C"
      abi: BaseRegistrar
      startBlock: 25000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - DomainOwner
        - Domain
      abis:
        - name: BaseRegistrar
          file: ./abis/BaseRegistrar.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,indexed uint256)
          handler: handleDomainTransfer
      file: ./src/mapping.ts

  # ── ENSRegistry ─────────────────────────────────────────────────
  - kind: ethereum
    name: ENSRegistry
    network: base
    source:
      address: "0xA590B208e7F2e62a3987424D2E1b00cd62986fAd"
      abi: ENSRegistry
      startBlock: 25000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - RegistryEvent
      abis:
        - name: ENSRegistry
          file: ./abis/ENSRegistry.json
      eventHandlers:
        - event: NewOwner(indexed bytes32,indexed bytes32,address)
          handler: handleNewOwner
        - event: NewResolver(indexed bytes32,address)
          handler: handleNewResolver
        - event: Transfer(indexed bytes32,address)
          handler: handleRegistryTransfer
      file: ./src/mapping.ts

  # ── ReferralVerifier ────────────────────────────────────────────
  - kind: ethereum
    name: ReferralVerifier
    network: base
    source:
      address: "0x212c27756529679efBd46cb35440b2e4DC28e33C"
      abi: ReferralVerifier
      startBlock: 25000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - DomainOwner
        - Referral
      abis:
        - name: ReferralVerifier
          file: ./abis/ReferralVerifier.json
      eventHandlers:
        - event: ReferralPaid(indexed address,indexed address,indexed bytes32,uint256,address,bool)
          handler: handleReferralPaid
        - event: RenewalReferralPaid(indexed address,indexed bytes32,indexed bytes32,uint256,address,bool)
          handler: handleRenewalReferralPaid
      file: ./src/mapping.ts

  # ── IDDomainAuction ─────────────────────────────────────────────
  - kind: ethereum
    name: IDDomainAuction
    network: base
    source:
      address: "0x7589b51FF60cf40046ec05247a68Eae397E37d30"
      abi: IDDomainAuction
      startBlock: 25000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Auction
        - Bid
      abis:
        - name: IDDomainAuction
          file: ./abis/IDDomainAuction.json
      eventHandlers:
        - event: AuctionCreated(indexed uint256,string,uint256,uint256,uint256,bool)
          handler: handleAuctionCreated
        - event: BidPlaced(indexed uint256,indexed address,uint256)
          handler: handleBidPlaced
        - event: AuctionExtended(indexed uint256,uint256)
          handler: handleAuctionExtended
        - event: AuctionSettled(indexed uint256,indexed address,uint256)
          handler: handleAuctionSettled
        - event: AuctionCancelled(indexed uint256)
          handler: handleAuctionCancelled
      file: ./src/mapping.ts

  # ── PremiumNameRegistry ─────────────────────────────────────────
  - kind: ethereum
    name: PremiumNameRegistry
    network: base
    source:
      address: "0xd88dfd4E3B9a14C66E40bD931eCA713192DD2Dba"
      abi: PremiumNameRegistry
      startBlock: 25000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - PremiumName
      abis:
        - name: PremiumNameRegistry
          file: ./abis/PremiumNameRegistry.json
      eventHandlers:
        - event: PremiumNameAdded(indexed string,bool,uint256)
          handler: handlePremiumNameAdded
        - event: PremiumNameRemoved(indexed string)
          handler: handlePremiumNameRemoved
      file: ./src/mapping.ts

  # ── USDC Transfer Tracking ──────────────────────────────────────
  - kind: ethereum
    name: USDC
    network: base
    source:
      address: "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"
      abi: ERC20
      startBlock: 25000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - DomainOwner
        - Transaction
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleUSDCTransfer
      file: ./src/mapping.ts

  # ── EntryPoint (Agent Detection) ────────────────────────────────
  - kind: ethereum
    name: EntryPoint
    network: base
    source:
      address: "0x0000000071727De22E5E9d8BAf0edAc6f37da032"
      abi: EntryPoint
      startBlock: 25000000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - DomainOwner
        - Transaction
      abis:
        - name: EntryPoint
          file: ./abis/EntryPoint.json
      eventHandlers:
        - event: UserOperationEvent(indexed bytes32,indexed address,indexed address,uint256,bool,uint256,uint256)
          handler: handleUserOperationEvent
      file: ./src/mapping.ts
